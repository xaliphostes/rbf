var w=Object.defineProperty;var C=(m,e,i)=>e in m?w(m,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):m[e]=i;var c=(m,e,i)=>C(m,typeof e!="symbol"?e+"":e,i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function i(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(t){if(t.ep)return;t.ep=!0;const s=i(t);fetch(t.href,s)}})();class b{constructor(e,i,n="thin_plate",t=0,s=null){c(this,"di");c(this,"weights");c(this,"nodes");c(this,"smooth");c(this,"epsilon");c(this,"norm");if(e.length!==i.length)throw new Error("Number of points must match number of values");if(e.length===0)throw new Error("At least one data point is required");this.nodes=e.map(o=>[...o]),this.di=[...i],this.smooth=t,s===null?this.epsilon=this.computeEpsilon(e):this.epsilon=s,this.norm=this.getRbfFunction(n),this.weights=this.computeWeights()}interpolate(e){return e.map(i=>this.interpolatePoint(i))}interpolatePoint(e){if(e.length!==this.nodes[0].length)throw new Error(`Point dimension (${e.length}) must match training data dimension (${this.nodes[0].length})`);let i=0;for(let n=0;n<this.nodes.length;n++)i+=this.weights[n]*this.norm(e,this.nodes[n]);return i}computeEpsilon(e){if(e.length<2)return 1;let i=0,n=0;const t=Math.min(e.length,100);for(let s=0;s<t;s++)for(let o=s+1;o<t;o++)i+=this.euclideanDistance(e[s],e[o]),n++;return n>0?i/n:1}euclideanDistance(e,i){let n=0;for(let t=0;t<e.length;t++){const s=e[t]-i[t];n+=s*s}return Math.sqrt(n)}getRbfFunction(e){switch(e.toLowerCase()){case"thin_plate":return(i,n)=>{const t=this.euclideanDistance(i,n);return t===0?0:t*t*Math.log(t)};case"multiquadric":return(i,n)=>{const t=this.euclideanDistance(i,n);return Math.sqrt(1+(this.epsilon*t)**2)};case"inverse_multiquadric":case"inverse":return(i,n)=>{const t=this.euclideanDistance(i,n);return 1/Math.sqrt(1+(this.epsilon*t)**2)};case"gaussian":return(i,n)=>{const t=this.euclideanDistance(i,n);return Math.exp(-((this.epsilon*t)**2))};case"linear":return(i,n)=>this.euclideanDistance(i,n);case"squared":return(i,n)=>this.euclideanDistance(i,n)**2;case"quintic":return(i,n)=>this.euclideanDistance(i,n)**5;default:throw new Error(`Unknown radial basis function: ${e}`)}}computeWeights(){const e=this.nodes.length,i=Array(e).fill(0).map(()=>Array(e).fill(0));for(let n=0;n<e;n++){for(let t=0;t<e;t++)i[n][t]=this.norm(this.nodes[n],this.nodes[t]);i[n][n]+=this.smooth}return this.solveLinearSystem(i,this.di)}solveLinearSystem(e,i){const n=e.length,t=e.map((o,a)=>[...o,i[a]]);for(let o=0;o<n;o++){let a=o;for(let h=o+1;h<n;h++)Math.abs(t[h][o])>Math.abs(t[a][o])&&(a=h);if([t[o],t[a]]=[t[a],t[o]],Math.abs(t[o][o])<1e-12)throw new Error("Matrix is singular or nearly singular");for(let h=o+1;h<n;h++){const r=t[h][o]/t[o][o];for(let l=o;l<=n;l++)t[h][l]-=r*t[o][l]}}const s=Array(n).fill(0);for(let o=n-1;o>=0;o--){let a=t[o][n];for(let h=o+1;h<n;h++)a-=t[o][h]*s[h];s[o]=a/t[o][o]}return s}}class E{constructor(){c(this,"canvas");c(this,"ctx");c(this,"colorbarCanvas");c(this,"colorbarCtx");c(this,"points",[]);c(this,"canvasWidth",600);c(this,"canvasHeight",600);c(this,"rbfFunction","thin_plate");c(this,"gridResolution",200);c(this,"smoothing",.01);c(this,"currentColorMap","turbo");c(this,"showPoints",!0);c(this,"showContours",!0);c(this,"interpolator",null);c(this,"gridValues",[]);c(this,"minValue",0);c(this,"maxValue",1);this.canvas=document.getElementById("visualization-canvas"),this.ctx=this.canvas.getContext("2d"),this.colorbarCanvas=document.getElementById("colorbar"),this.colorbarCtx=this.colorbarCanvas.getContext("2d"),this.setupCanvas(),this.setupEventListeners(),this.loadPreset("peaks")}setupCanvas(){this.canvas.width=this.canvasWidth,this.canvas.height=this.canvasHeight,this.colorbarCanvas.width=400,this.colorbarCanvas.height=30}setupEventListeners(){this.canvas.addEventListener("click",r=>this.handleCanvasClick(r)),this.canvas.addEventListener("mousemove",r=>this.handleMouseMove(r)),document.getElementById("rbf-function").addEventListener("change",r=>{this.rbfFunction=r.target.value,this.updateVisualization()});const i=document.getElementById("grid-resolution"),n=document.getElementById("grid-res-value");i.addEventListener("input",r=>{this.gridResolution=parseInt(r.target.value),n.textContent=`${this.gridResolution}x${this.gridResolution}`,this.updateVisualization()});const t=document.getElementById("smoothing"),s=document.getElementById("smooth-value");t.addEventListener("input",r=>{this.smoothing=parseFloat(r.target.value),s.textContent=this.smoothing.toFixed(2),this.updateVisualization()}),document.getElementById("colormap").addEventListener("change",r=>{this.currentColorMap=r.target.value,this.draw()}),document.getElementById("show-points").addEventListener("change",r=>{this.showPoints=r.target.checked,this.draw()}),document.getElementById("show-contours").addEventListener("change",r=>{this.showContours=r.target.checked,this.draw()}),document.querySelectorAll(".preset-btn").forEach(r=>{r.addEventListener("click",l=>{const u=l.target.dataset.preset;this.loadPreset(u)})}),document.getElementById("add-point-btn").addEventListener("click",()=>{this.addRandomPoint()}),document.getElementById("clear-points-btn").addEventListener("click",()=>{this.clearPoints()}),document.getElementById("upload-csv-btn").addEventListener("click",()=>{document.getElementById("csv-file-input").click()}),document.getElementById("csv-file-input").addEventListener("change",r=>{const l=r.target;l.files&&l.files[0]&&this.loadCSVFile(l.files[0])})}handleCanvasClick(e){const i=this.canvas.getBoundingClientRect(),n=(e.clientX-i.left)/this.canvasWidth,t=(e.clientY-i.top)/this.canvasHeight,s=Math.random();this.addPoint(n,t,s)}handleMouseMove(e){const i=this.canvas.getBoundingClientRect(),n=(e.clientX-i.left)/this.canvasWidth,t=(e.clientY-i.top)/this.canvasHeight;let s=`x: ${n.toFixed(3)}, y: ${t.toFixed(3)}`;if(this.interpolator&&n>=0&&n<=1&&t>=0&&t<=1)try{const o=this.interpolator.interpolatePoint([n,t]);s+=` | value: ${o.toFixed(3)}`}catch{}document.getElementById("hover-coords").textContent=s}addPoint(e,i,n){this.points.push({x:e,y:i,value:n}),this.updatePointsList(),this.updateVisualization()}addRandomPoint(){const e=Math.random(),i=Math.random(),n=Math.random();this.addPoint(e,i,n)}removePoint_(e){this.points.splice(e,1),this.updatePointsList(),this.updateVisualization()}clearPoints(){this.points=[],this.updatePointsList(),this.updateVisualization()}async loadCSVFile(e){try{const i=await e.text();this.parseAndLoadCSV(i)}catch(i){console.error("Error loading CSV file:",i),alert("Error loading CSV file. Please make sure it is a valid CSV file.")}}parseAndLoadCSV(e){const i=e.trim().split(`
`);if(i.length<2){alert("CSV file must have at least a header row and one data row.");return}const n=i[0].split(/[;,]/),t=n.findIndex(d=>/lat/i.test(d.trim())||/y/i.test(d.trim())),s=n.findIndex(d=>/lon/i.test(d.trim())||/lng/i.test(d.trim())||/x/i.test(d.trim())),o=n.findIndex(d=>/val/i.test(d.trim())||/z/i.test(d.trim())||/h2/i.test(d.trim())||/ppm/i.test(d.trim()));if(t===-1||s===-1||o===-1){alert(`Could not find latitude, longitude, and value columns.
Expected columns like: LATITUDE, LONGITUDE, VALUE (or X, Y, Z)`);return}const a=[];let h=1/0,r=-1/0,l=1/0,u=-1/0,g=1/0,f=-1/0;for(let d=1;d<i.length;d++){const y=i[d].trim();if(!y)continue;const p=y.split(/[;,]/);if(p.length<=Math.max(t,s,o))continue;const x=parseFloat(p[t]),v=parseFloat(p[s]),M=parseFloat(p[o]);isNaN(x)||isNaN(v)||isNaN(M)||(h=Math.min(h,x),r=Math.max(r,x),l=Math.min(l,v),u=Math.max(u,v),g=Math.min(g,M),f=Math.max(f,M),a.push({x:v,y:x,value:M}))}if(a.length===0){alert("No valid data points found in CSV file.");return}this.points=a.map(d=>({x:(d.x-l)/(u-l),y:(d.y-h)/(r-h),value:(d.value-g)/(f-g)})),console.log(`Loaded ${this.points.length} points from CSV`),console.log(`Lat range: ${h} to ${r}`),console.log(`Lon range: ${l} to ${u}`),console.log(`Value range: ${g} to ${f}`),this.updatePointsList(),this.updateVisualization()}updatePointsList(){const e=document.getElementById("points-list"),i=document.getElementById("point-count");if(i.textContent=this.points.length.toString(),this.points.length===0){e.innerHTML='<p style="color: #6c757d; font-size: 0.85rem;">No points yet. Click on canvas to add.</p>';return}e.innerHTML=this.points.map((n,t)=>`
      <div class="point-item">
        <span>P${t+1}: (${n.x.toFixed(2)}, ${n.y.toFixed(2)}) = ${n.value.toFixed(2)}</span>
        <button onclick="window.visualizer.removePoint(${t})">Ã—</button>
      </div>
    `).join("")}async loadPreset(e){switch(this.points=[],e){case"h2_frantz":try{const n=await(await fetch("/h2_frantz.csv")).text();this.parseAndLoadCSV(n);return}catch(i){console.error("Error loading H2 Frantz data:",i),alert("Could not load H2 Frantz data file.");return}case"peaks":for(let i=0;i<25;i++){const n=Math.random(),t=Math.random(),s=this.peaksFunction(n*6-3,t*6-3);this.points.push({x:n,y:t,value:(s+6)/12})}break;case"ripple":for(let i=0;i<20;i++){const n=Math.random(),t=Math.random(),s=Math.sin(n*Math.PI*4)*Math.cos(t*Math.PI*4);this.points.push({x:n,y:t,value:(s+1)/2})}break;case"random":for(let i=0;i<15;i++)this.points.push({x:Math.random(),y:Math.random(),value:Math.random()});break;case"gradient":this.points=[{x:0,y:0,value:0},{x:1,y:0,value:.5},{x:0,y:1,value:.5},{x:1,y:1,value:1},{x:.5,y:.5,value:.5}];break;case"saddle":for(let i=0;i<20;i++){const n=Math.random(),t=Math.random(),s=n-.5,o=t-.5,a=s*s-o*o;this.points.push({x:n,y:t,value:a+.5})}break}this.updatePointsList(),this.updateVisualization()}peaksFunction(e,i){return 3*(1-e)**2*Math.exp(-(e**2)-(i+1)**2)-10*(e/5-e**3-i**5)*Math.exp(-(e**2)-i**2)-1/3*Math.exp(-((e+1)**2)-i**2)}updateVisualization(){if(this.points.length<3){this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.fillStyle="#f8f9fa",this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.fillStyle="#6c757d",this.ctx.font="16px sans-serif",this.ctx.textAlign="center",this.ctx.fillText("Add at least 3 points to see interpolation",this.canvasWidth/2,this.canvasHeight/2),this.showPoints&&this.drawPoints();return}const e=performance.now();try{const i=this.points.map(s=>[s.x,s.y]),n=this.points.map(s=>s.value);this.interpolator=new b(i,n,this.rbfFunction,this.smoothing),this.generateGrid();const t=performance.now();document.getElementById("interp-time").textContent=`${(t-e).toFixed(1)}ms`,this.draw()}catch(i){console.error("Interpolation error:",i),this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.fillStyle="#dc3545",this.ctx.font="14px sans-serif",this.ctx.textAlign="center",this.ctx.fillText("Error during interpolation",this.canvasWidth/2,this.canvasHeight/2)}}generateGrid(){this.gridValues=[];const e=1/(this.gridResolution-1);this.minValue=1/0,this.maxValue=-1/0;for(let i=0;i<this.gridResolution;i++){const n=[];for(let t=0;t<this.gridResolution;t++){const s=i*e,o=t*e,a=this.interpolator.interpolatePoint([s,o]);n.push(a),this.minValue=Math.min(this.minValue,a),this.maxValue=Math.max(this.maxValue,a)}this.gridValues.push(n)}document.getElementById("colorbar-min").textContent=this.minValue.toFixed(2),document.getElementById("colorbar-max").textContent=this.maxValue.toFixed(2)}draw(){this.gridValues.length!==0&&(this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.drawSurface(),this.showContours&&this.drawContours(),this.showPoints&&this.drawPoints(),this.drawColorbar())}drawSurface(){const e=this.canvasWidth/(this.gridResolution-1),i=this.canvasHeight/(this.gridResolution-1);for(let n=0;n<this.gridResolution-1;n++)for(let t=0;t<this.gridResolution-1;t++){const o=(this.gridValues[n][t]-this.minValue)/(this.maxValue-this.minValue),a=this.getColor(o);this.ctx.fillStyle=`rgb(${a[0]}, ${a[1]}, ${a[2]})`,this.ctx.fillRect(n*e,t*i,e+1,i+1)}}drawContours(){const i=(this.maxValue-this.minValue)/10;this.ctx.strokeStyle="rgba(0, 0, 0, 0.3)",this.ctx.lineWidth=1;for(let n=0;n<=10;n++){const t=this.minValue+n*i;this.drawContourLevel(t)}}drawContourLevel(e){const i=this.canvasWidth/(this.gridResolution-1),n=this.canvasHeight/(this.gridResolution-1);for(let t=0;t<this.gridResolution-1;t++)for(let s=0;s<this.gridResolution-1;s++){const o=this.gridValues[t][s],a=this.gridValues[t+1][s],h=this.gridValues[t][s+1],r=this.gridValues[t+1][s+1],l=t*i,u=s*n;(o<=e&&e<=r||o>=e&&e>=r||a<=e&&e<=h||a>=e&&e>=h)&&((o<e&&r>e||o>e&&r<e)&&(this.ctx.beginPath(),this.ctx.moveTo(l,u+n),this.ctx.lineTo(l+i,u),this.ctx.stroke()),(a<e&&h>e||a>e&&h<e)&&(this.ctx.beginPath(),this.ctx.moveTo(l,u),this.ctx.lineTo(l+i,u+n),this.ctx.stroke()))}}drawPoints(){this.points.forEach((e,i)=>{const n=e.x*this.canvasWidth,t=e.y*this.canvasHeight;this.ctx.beginPath(),this.ctx.arc(n,t,6,0,2*Math.PI),this.ctx.fillStyle="white",this.ctx.fill(),this.ctx.strokeStyle="#333",this.ctx.lineWidth=2,this.ctx.stroke(),this.ctx.fillStyle="#333",this.ctx.font="bold 11px sans-serif",this.ctx.textAlign="center",this.ctx.fillText(e.value.toFixed(2),n,t-10)})}drawColorbar(){const e=this.colorbarCanvas.width,i=this.colorbarCanvas.height;for(let n=0;n<e;n++){const t=n/e,s=this.getColor(t);this.colorbarCtx.fillStyle=`rgb(${s[0]}, ${s[1]}, ${s[2]})`,this.colorbarCtx.fillRect(n,0,1,i)}}getColor(e){e=Math.max(0,Math.min(1,e));const i={viridis:t=>{const s=255*(.267+.867*t-1.333*t**2+.491*t**3),o=255*(.005+1.429*t-.972*t**2+.282*t**3),a=255*(.329+1.074*t-3.185*t**2+2.479*t**3);return[Math.round(s),Math.round(o),Math.round(a)]},plasma:t=>{const s=255*(.05+2.258*t-2.385*t**2+.811*t**3),o=255*(.02+.17*t+2.49*t**2-2.155*t**3),a=255*(.527+2.666*t-6.364*t**2+3.797*t**3);return[Math.round(s),Math.round(o),Math.round(a)]},turbo:t=>{const s=255*Math.sin(Math.PI*(t*.75+.67)),o=255*Math.sin(Math.PI*(t*.75+.25)),a=255*Math.sin(Math.PI*(t*.75-.17));return[Math.round(Math.max(0,s)),Math.round(Math.max(0,o)),Math.round(Math.max(0,a))]},coolwarm:t=>{const s=255*(.23+1.54*t-1.54*t**2+.77*t**3),o=255*(.3+1.53*t-3.06*t**2+1.23*t**3),a=255*(.75-1.5*t+1.5*t**2-.75*t**3);return[Math.round(s),Math.round(o),Math.round(a)]},rainbow:t=>{const s=255*Math.sin(Math.PI*t),o=255*Math.sin(Math.PI*(t+.33)),a=255*Math.sin(Math.PI*(t+.67));return[Math.round(Math.max(0,s)),Math.round(Math.max(0,o)),Math.round(Math.max(0,a))]}};return(i[this.currentColorMap]||i.turbo)(e)}removePoint(e){this.removePoint_(e)}}const P=new E;window.visualizer=P;
//# sourceMappingURL=index-Dy5kVs1W.js.map
